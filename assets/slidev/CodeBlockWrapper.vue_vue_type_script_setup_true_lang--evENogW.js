import{_ as I,a as E}from"../modules/unplugin-icons-B5_8poBY.js";import{d as V,r as M,M as q,G as S,N as $,z as g,O as z,P as D,f as m,o as r,i as b,j as K,e as T,g as j,t as R,K as u,n as x,b as N,k as G}from"../modules/vue-_oRhHds5.js";import{m as O,C as P,a as U,u as W}from"../index-OhF6NGAi.js";import{u as X}from"./context-CEKKznhC.js";import{c as w}from"../monaco/bundled-types-DePaNWGI.js";import{_ as F}from"./TitleIcon.vue_vue_type_script_setup_true_lang-3O9NkRC-.js";const J=["data-title"],Q={key:0,class:"slidev-code-block-title"},Y={class:"leading-1em"},Z=["title"],ne=V({__name:"CodeBlockWrapper",props:{ranges:{type:Array,default:()=>[]},finally:{type:[String,Number],default:"last"},startLine:{type:Number,default:1},lines:{type:Boolean,default:w.lineNumbers},at:{type:[String,Number],default:"+1"},maxHeight:{type:String,default:void 0},title:{type:String,default:void 0}},setup(a){const e=a,{$clicksContext:n}=X(),l=M(),p=O();q(()=>{n.unregister(p)}),S(()=>{var t;(t=l.value)==null||t.classList.toggle("slidev-code-line-numbers",e.lines)}),$(()=>{var c;if(!n||!((c=e.ranges)!=null&&c.length))return;const t=n.calculateSince(e.at,e.ranges.length-1);n.register(p,t);const o=g(()=>t?Math.max(0,n.current-t.start+1):P),i=g(()=>e.finally==="last"?e.ranges.at(-1):e.finally.toString());S(()=>{if(!l.value)return;let d=e.ranges[o.value]??i.value;const y=d==="hide";l.value.classList.toggle(U,y),y&&(d=e.ranges[o.value+1]??i.value);const _=l.value.querySelector(".shiki"),k=Array.from(_.querySelectorAll("code > .line")),A=k.length;if(W(d,A,e.startLine,s=>[k[s]]),e.maxHeight){const s=Array.from(_.querySelectorAll(".line.highlighted"));s.reduce((C,B)=>B.offsetHeight+C,0)>l.value.offsetHeight?s[0].scrollIntoView({behavior:"smooth",block:"start"}):s.length>0&&s[Math.round((s.length-1)/2)].scrollIntoView({behavior:"smooth",block:"center"})}})});const{copied:f,copy:H}=z();function L(){var o,i;const t=(i=(o=l.value)==null?void 0:o.querySelector(".slidev-code"))==null?void 0:i.textContent;t&&H(t)}const h=D("activeTitle",null),v=g(()=>h===null&&e.title);return(t,o)=>{const i=I,c=E;return r(),m("div",{ref_key:"el",ref:l,class:x(["slidev-code-wrapper relative group",{"slidev-code-line-numbers":e.lines,active:u(h)===a.title}]),style:G({"max-height":e.maxHeight,"overflow-y":e.maxHeight?"scroll":void 0,"--start":e.startLine}),"data-title":a.title},[v.value?(r(),m("div",Q,[T(F,{title:a.title},null,8,["title"]),j("div",Y,R(a.title.replace(/~([^~]+)~/g,"").trim()),1)])):b("v-if",!0),K(t.$slots,"default"),u(w).codeCopy?(r(),m("button",{key:1,class:x(["slidev-code-copy absolute right-0 transition opacity-0 group-hover:opacity-20 hover:!opacity-100",v.value?"top-10":"top-0"]),title:u(f)?"Copied":"Copy",onClick:o[0]||(o[0]=d=>L())},[u(f)?(r(),N(i,{key:0,class:"p-2 w-8 h-8"})):(r(),N(c,{key:1,class:"p-2 w-8 h-8"}))],10,Z)):b("v-if",!0)],14,J)}}});export{ne as _};
